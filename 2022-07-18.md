# 18 July 2022
# or, Consolidated TODOs, LLC

## Groups

- `nextstrain remote download` and `upload` behaviour tweaks

  - remote upload: when to use local filename and when to not
  - remote download: include more of URL in the local filename
  - remote download: Local path prefix for multiple datasets, not just directory
    
    If a single part path (i.e. no slashes) which doesn't exist, then treat as
    file basename prefix instead of missing directory.

    If a multi-part path which doesn't exist but where the parent path exists,
    then treat as a path + file basename prefix instead of a missing directory.

  - [`--prompt` and `--dry-run` modes](https://github.com/nextstrain/cli/issues/149)

- Groups customizations
  - Write up CLI commands issue

        nextstrain group {name} logo get
        nextstrain group {name} logo set {filename}
        nextstrain group {name} overview get
        nextstrain group {name} overview set {filename}

        nextstrain remote upload groups/{name} group-overview.md
        nextstrain remote upload groups/{name} group-logo.png

  - Write up web UI issue?
  - Update "sourceInfo" to point to these URLs instead of fetching/embedding?


- Timeline for sending out migration emails?
  - Review https://docs.nextstrain.org/en/latest/guides/share/groups/migrate-from-s3.html#notification

- Groups member management
  - API
    - List roles
      GET /groups/:groupName/~/roles

    - List members of role (memberships)
      GET /groups/:groupName/~/roles/:roleName/members

    - Get member of a role (membership)
      GET /groups/:groupName/~/roles/:roleName/members/:username
        returns metadata about this _membership_, e.g. metadata like
        "created_at" or similar, or who added the user to the role.  don't
        know if we have that metadata, so may be sparse for now, but still a
        useful endpoint for existence.

    - Add member to role (results in new member or adding role to existing member)
      PUT /groups/:groupName/~/roles/:roleName/members/:username

    - Remove member from a role
      DELETE /groups/:groupName/~/roles/:roleName/members/:username
  - CLI? maybe not, but users need some way of interacting?

## Internalish stuff

- PUT/DELETE support for core and staging
  - Invalidations are sidestepped because the server no longer goes thru CloudFront
  - Authz policy could use internal Cognito group, e.g. `@core`

- Audit use of Cache-Control
  - nextstrain.org endpoints
    - Add cache control headers at source routing level.
    - All pages get private, no-cache (max-age=0, must-revalidate).
  - S3 object metadata
    - Set on upload via nextstrain.org.
  - Cloudfront distribution configuration
    - <https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Expiration.html>
    - Fix cloudfront for data.nextstrain.org
    - Use long min TTL since we use invalidations anyway!??

- 


## Buildpacks


- How to make images
- How to run them
  - Single build dir now becomes image + extra files dir (like with ncov +
    profiles or Terra/WDL)
- Good update story for software + pipeline + data, etc. with nextstrain
  update.


## Other stuff

- Terms of Service and Privacy Policy (uggh)

- nextstrain.org logging (see issue)

- "Runtime" naming in Nextstrain CLI

- CLI
  - Narratives support for `nextstrain view`
    <https://github.com/nextstrain/cli/issues/128#issuecomment-978100714>
  - Improved `check-setup`
    - Faster, do things in parallel
  - Improved `update`
  - New `setup` command
  - Local tracking of detached builds
  - Live streaming of files back from remote builds using Dat/Hypercores
  - use Link header to know which sidecars to fetch (avoids enumerating them solely on the client)
  - Env var support
    - `--envdir my-env.d`
    - `--env FOO` (implemented in terms of an env dir)
    - See bespoke prior art in ncov-ingest here (and 2018-era
      thinking-aloud-as-WIPs in the CLI itself)
    - `write-envdir` command (see WIP)


- Search/indexing, see [2022-03-10](2022-03-10.md)

- Metrics
  <https://docs.google.com/document/d/1zdcRqspkOiDqaop7qiRDarG5YAsWKCQG2CIT7s-hrPg/edit#>

- Ephemeral AWS credentials for our GitHub Actions workflows
  <https://github.com/nextstrain/private/issues/22>
