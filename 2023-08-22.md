# 22 August 2023
# or, Self-hosted GitHub Actions runners

Let's do this.  More convinced than ever that we shouldn't keep putting it off.
Here's why.

 1. We want to [stay attached](https://github.com/nextstrain/.github/pull/44#discussion_r1214646489)
    to pathogen builds running on AWS Batch launched by GitHub Actions
    workflows.

    Doing so requires long-lived GitHub Actions jobs which would bump us into concurrency limits pretty quickly.

 2. I [roughed](https://gist.github.com/tsibley/258ab1b1e76f0bb32dbc3c17f892c169) [out](https://github.com/tsibley/blab-standup/blob/master/2023-08-18.md) [job chaining](), and [it works](https://github.com/nextstrain/.github/actions/runs/5932617642/job/16086780919#step:5:1)!

 2. [My previous noodling on autoscaling self-hosted runners on EC2](2022-09-14.md)
  
    I still like the idea of a simpler, less bells-and-whistles approach to
    autoscaling on EC2 where the control plane (orchestration layer) remains
    all within GitHub Actionsâ€¦ but it probably doesn't make sense to build this
    out ourselves.
    
    We should just use [philips-labs/terraform-aws-github-runner](https://github.com/philips-labs/terraform-aws-github-runner).
    Its AWS Lambda-based (i.e. scale-to-zero) control plane and support for
    ephemeral runners of makes it appealing.

- https://gist.github.com/tsibley/ad8bf3c8d2fad924195b5bbee01823fb

## Conclusions

- Establish an AWS Organization as a container for AWS accounts
- Separate AWS account for this infra
- Ephemeral runners only (c.f. [considerations for Philips Labs approach](https://github.com/philips-labs/terraform-aws-github-runner#ephemeral-runners))

## Security

- <https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions#hardening-for-self-hosted-runners>
- <https://github.com/philips-labs/terraform-aws-github-runner#security-considerations>
