# 10 May 2022
# or, lab meeting on recs

## Background

- [Proposal for an Augur `transform` command](https://github.com/nextstrain/augur/issues/860)

  Actual name and syntax TBD.

- [My talk on `recs`, or RecordStream](https://docs.google.com/presentation/d/1993xaZPMukiYincnwjFK9VgXkJu3gU5E00CzwZgj_n4)


## ðŸ’­

### Chaining

- Chaining can be multi-process or single-process.

- Ad-hoc multi-process chaining with pipes is super important for exploration,
  experimentation, iterative development, and meeting unanticipated needs (e.g.
  piping over a network, piping to non-Augur commands).

- It is often often enough/just fine for many workflows.

- Operationalized workflows and workflows with heavy data lifting will want a
  way to optimize runtime.  Single-process chaining can help here (but not
  always!).


#### Chaining examples

All hypothetical, meant to give the flavor of what's possible/plausible.

```bash
augur transform titlecase --metadata metadata.tsv --fields region country division \
  | augur transform format-date --date-column collection_date \
  | augur transform rename-columns --columns "Virus name=strain" "Collection date=date" \
  | augur transform normalize-strings --output transformed_metadata.tsv

augur transform titlecase --metadata metadata.tsv --fields region country division \
  \| format-date --date-column collection_date \
  \| rename-columns --columns "Virus name=strain" "Collection date=date" \
  \| normalize-strings --output transformed_metadata.tsv

augur transform pipeline --metadata metadata.tsv --output transformed_metadata.tsv '
    titlecase --fields region country division
  | format-date --date-column collection_date
  | rename-columns --columns "Virus name=strain" "Collection date=date"
  | normalize-strings
'
```

```bash
augur transform pipeline \
  --metadata metadata.tsv \
  --steps x.yaml \
  --output transformed_metadata.tsv
```
```yaml
---
pipeline:
  - titlecase:
      fields:
        - region
        - country
        - division
  - format-date:
      date-column: collection_date
  - rename-columns:
      columns:
        "Virus name": strain
        "Collection date": date
  - normalize-strings
```

```bash
#!/usr/bin/env augur-transform-pipeline
titlecase --metadata metadata.tsv --fields region country division
format-date --date-column collection_date
rename-columns --columns "Virus name=strain" "Collection date=date"
normalize-strings --output transformed_metadata.tsv
```
