# 7 November 2025
# or, …

_10:00–15:00 (5h + 21h = 26h)_  

- [x] Write up workflows-as-programs design notes and principles
      ([done](https://github.com/nextstrain/public/issues/1#issuecomment-3505006178))
- [ ] Diagram AWS Batch runtime?
- [x] Review what's [percolating][]
    - Support RESTful API PUT and DELETE endpoints for core and staging
- [ ] Review local WIPs for Nextstrain CLI
    - [Remotes in CLI doc](https://github.com/nextstrain/cli/pull/334)
    - [Update "build directory" terminology in CLI help and docs](https://github.com/nextstrain/cli/issues/371)
- [~] Review local WIPs for nextstrain.org
    - `trs/tmp-source`?
    - `trs/wip/api/later`?
- [x] Submit last timesheet


## Design notes/principles for "workflows as programs"

_I originally jotted these down in my personal notes and then collected them in
[one
place](https://github.com/tsibley/blab-standup/blob/master/2024-11-07.md#workflows-as-programs-design-notesprinciples)
a year ago (to the day!).  Today, I've lightly revised them for clarity and am
posting them here for more visibility.  I think these are useful things to keep
in mind when continuing work on "workflows as programs"._

_We never had much of a culture of design docs—though many were certainly
written and used—and so there's not a single obvious place for this.  Perhaps
it should be incorporated into our overarching pages on docs.nextstrain.org, or
perhaps shunted into the "design docs" folder on the shared Google Drive, or
perhaps elsewhere.  For now, here it remains._

- The user-provided directory for inputs, outputs, etc. is the "working
  analysis directory" in full.  This may sometimes be shortened to "analysis
  directory" (e.g. in conversation, in Nextstrain CLI) or "working directory"
  (e.g. from Snakemake's perspective).

- `nextstrain build` continues to work and is not deprecated/phased out.
  `nextstrain run` and related workflow-level changes are higher-level
  wrappings around that (conceptually, if not in actuality).

- No passthru of arguments to Snakemake à la `nextstrain build`.  Instead,
  recapitulate or bundle/wrap options we want to expose.  If you must pass
  arbitrary args to Snakemake, then either use `nextstrain build` or invoke
  Snakemake yourself.

- Pathogen repos should be versioned (i.e. with Git tags) and [keep a
  changelog](https://keepachangelog.com/en/1.1.0/).

- [No magic in workflows.](https://github.com/nextstrain/public/issues/1#issuecomment-2463068756)
  Things that can be done via `nextstrain run` should be able to be done with
  `nextstrain build` too, albeit with potentially greater verbosity, but
  _without_ monumental effort.

- Workflows are addressed by **names not paths**.  As a fallback, the name may
  be used to construct a path, but a workflow's name need not correspond to the
  workflow's path.

- Hosting of workflows for `nextstrain setup` needs only a ZIP file and static
  file server (i.e. not a Git server or anything else dynamic).

  For our own workflows, we point at nextstrain.org and have it resolve to
  GitHub archive URLs, but that's not intended to be normative.

- Convention of only using the `Snakefile` filename for supported workflow
  **entrypoints**, not for imported Snakemake workflow files.

- Use `workflow.basedir` or `workflow.current_basedir`; avoid
  `workflow.source_path(…)` (it has
  [issues](https://github.com/tsibley/blab-standup/tree/@/2024-10-23.md)).

  These are not compatible with being used as a remote module, but our
  workflows aren't used as remote modules.  (Used as a local module is fine.)

  `workflow.basedir` is the current `Snakefile`'s dir, e.g. dir of top-level `Snakefile`.
  `workflow.current_basedir` is the current Snakemake file's dir, e.g. `…/rules/` for a `…/rules/abc.smk`.
  In the top-level `Snakefile`, they're the same.
