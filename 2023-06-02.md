# 2 June 2023
# or, envdirs

_[previously](2022-08-26.md)_

New global runner options (akin to `--exec`) registered `nextstrain/cli/runner/__init__.py:register_arguments`:

    --env NAME
    --env NAME=VALUE
    --envdir PATH

Handled in `nextstrain/cli/runner/__init__.py:run` by XXX FIXME...
  Or maybe handled in `exec_or_return()` as an optional envdir argument?

Each runner would then be responsible doing the most reasonable thing to get
the values into the runtime environment.

  - Docker would mount the envdir on the host as /nextstrain/env.d in the
    container and arrange to exec thru `envdir /nextstrain/env.d` (possibly via
    the entrypoint).

  - Singularity would do the same as Docker.

  - Conda would arrange to exec thru `envdir LOCAL-DIR`.

  - Ambient would exec within `with envdir.Env(â€¦)` or possibly thru `envdir
    LOCAL-DIR`.

  - AWS Batch would upload the envdir to S3 separately from the workdir and
    arrange to exec thru `envdir /nextstrain/env.d` (possibly via the
    entrypoint).

    Possibly, instead of a separate workdir archive, the archive could become a
    a combined archive rooted at /nextstrain instead of /nextstrain/build?

While there are non-envdir methods for all runtimes, the above all go thru a
written-to-disk envdir because because that avoids revealing the env values in
side-channels like `docker inspect`, AWS Batch job submissions, process
listings, etc.
