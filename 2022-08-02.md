# 2 August 2022
# or, â€¦

- Do we use a custom stack?
  - This would be to make our stack `nextstrain/base` (run image) and
    `nextstrain/base-builder` (build image).

  - Is that worth it?  Maybe not?

  - Better to use someone else's stack and use a custom buildpack to install
    our deps on top?  I think so.


- [Custom builder](https://buildpacks.io/docs/operator-guide/create-a-builder/) (e.g. `nextstrain/builder`)
  - [Off-the-shelf stack](https://paketo.io/docs/concepts/stacks/), e.g. Ubuntu 22.04 from Paketo (`paketobuildpacks/build-jammy-full`, `io.buildpacks.stacks.jammy`)
  - Off-the-shelf buildpacks (e.g. from Paketo), configured to co-op


- Builder image is used to produce pathogen repo/workflow images that contain
  - Stack run image
  - Buildpack-provided layers
    - Workflow dependencies
    - Nextstrain toolchain (probably not actually from `nextstrain/base` image?)
  - Pathogen workflow source


Our buildpack, `nextstrain/buildpack`, would have a bin/detect and bin/build
that did the right things, plus TOML config for the necessary deps for
bin/build.

Detect nextstrain.yaml:

    ---
    workflow:
      name: seasonal-flu

This name is also used by `nextstrain pack` or whatever command that builds
workflow images.

Build step involves adding the right deps, e.g. what we currently include in
nextstrain/base image.
